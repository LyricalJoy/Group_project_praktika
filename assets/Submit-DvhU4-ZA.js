import{_ as w,r as u,o as V,w as F,h as M,c as o,b as l,j as g,i as n,v as _,l as C,F as D,e as j,m as q,t as h,f as r}from"./index-I6tTBhsB.js";const N={class:"container"},B={class:"form"},L={key:0,class:"error"},R={key:1,class:"error"},J=["value"],O={key:2,class:"error"},T={key:3},z={key:0,class:"error"},A={key:4,class:"error"},E={key:5,class:"error"},$={key:6,class:"error"},G={class:"checkbox-wrapper"},H={for:"agree",style:{display:"flex","align-items":"center"}},K={key:7,class:"error"},P={key:8,class:"success"},Q={__name:"Submit",setup(W){const d=u(""),p=u(""),i=u(""),c=u(""),v=u(null),k=u("Все"),I=["Дороги","Освещение","Мусор","Вандализм","Другое"],f=u([]),t=u([]),y=u(""),b=u(!1),m=u("");u(!1),u(null),V(()=>{const s=localStorage.getItem("currentUserId");s?m.value=s:(m.value="user_"+Math.random().toString(36).substring(2,10),localStorage.setItem("currentUserId",m.value));const e=localStorage.getItem("requests");e&&(f.value=JSON.parse(e))}),F(f,s=>{localStorage.setItem("requests",JSON.stringify(s))},{deep:!0});function S(){return t.value=[],d.value||t.value.push("Название обязательно"),p.value||t.value.push("Описание обязательно"),i.value||t.value.push("Категория обязательна"),i.value==="Другое"&&!c.value.trim()&&t.value.push('Уточните категорию в поле "Другое"'),b.value||t.value.push("Необходимо согласие на обработку данных"),v.value?["image/jpeg","image/jpg","image/png","image/bmp"].includes(v.value.type)?v.value.size>10*1024*1024&&t.value.push("Максимальный размер фото — 10Мб"):t.value.push("Недопустимый формат изображения"):t.value.push("Фото обязательно"),t.value.length===0}function U(){if(!S())return;const s=new FileReader;s.onload=()=>{const e={id:Date.now(),title:d.value,description:p.value,category:i.value==="Другое"?`Другое: ${c.value}`:i.value,status:"Новая",timestamp:new Date().toLocaleString(),imageUrl:s.result,userId:m.value};f.value.push(e),d.value="",p.value="",i.value="",c.value="",v.value=null,y.value="Заявка успешно отправлена!",setTimeout(()=>y.value="",4e3)},s.readAsDataURL(v.value)}function x(s){v.value=s.target.files[0]}return M(()=>f.value.filter(s=>s.userId===m.value&&(k.value==="Все"||s.status===k.value))),(s,e)=>(r(),o("div",N,[e[12]||(e[12]=l("h1",null,"Создание заявки",-1)),l("div",B,[e[8]||(e[8]=l("label",null,"Название",-1)),g(l("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),placeholder:"Например: Яма на дороге"},null,512),[[_,d.value]]),t.value.includes("Название обязательно")?(r(),o("p",L,"Название обязательно")):n("",!0),e[9]||(e[9]=l("label",null,"Описание",-1)),g(l("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>p.value=a),placeholder:"Опишите проблему..."},null,512),[[_,p.value]]),t.value.includes("Описание обязательно")?(r(),o("p",R,"Описание обязательно")):n("",!0),e[10]||(e[10]=l("label",null,"Категория",-1)),g(l("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>i.value=a)},[e[5]||(e[5]=l("option",{disabled:"",value:""},"Выберите категорию",-1)),(r(),o(D,null,j(I,a=>l("option",{key:a,value:a},h(a),9,J)),64))],512),[[C,i.value]]),t.value.includes("Категория обязательна")?(r(),o("p",O,"Категория обязательна")):n("",!0),i.value==="Другое"?(r(),o("div",T,[e[6]||(e[6]=l("label",null,"Уточните категорию",-1)),g(l("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a),placeholder:"Например: Нарушение правил парковки"},null,512),[[_,c.value]]),t.value.includes('Уточните категорию в поле "Другое"')?(r(),o("p",z,"Уточните категорию")):n("",!0)])):n("",!0),e[11]||(e[11]=l("label",null,"Фото (jpg, png, bmp, до 10Мб)",-1)),l("input",{type:"file",accept:"image/*",onChange:x},null,32),t.value.includes("Фото обязательно")?(r(),o("p",A,"Фото обязательно")):n("",!0),t.value.includes("Недопустимый формат изображения")?(r(),o("p",E,"Недопустимый формат изображения")):n("",!0),t.value.includes("Максимальный размер фото — 10Мб")?(r(),o("p",$,"Максимальный размер фото — 10Мб")):n("",!0),l("div",G,[l("label",H,[g(l("input",{type:"checkbox",id:"agree","onUpdate:modelValue":e[4]||(e[4]=a=>b.value=a),style:{"margin-right":"0",margin:"0",padding:"0"}},null,512),[[q,b.value]]),e[7]||(e[7]=l("span",{style:{"margin-left":"0"}},"Согласен на обработку персональных данных",-1))])]),t.value.includes("Необходимо согласие на обработку данных")?(r(),o("p",K,"Необходимо согласие на обработку данных")):n("",!0),l("button",{class:"submit-btn",onClick:U},"Отправить заявку"),y.value?(r(),o("p",P,h(y.value),1)):n("",!0)])]))}},Y=w(Q,[["__scopeId","data-v-9fb22ca6"]]);export{Y as default};
