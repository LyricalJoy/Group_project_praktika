import{_,r as c,c as p,f as u,b as s,j as b,i as g,v as y,g as U,t as v,p as P,k as $,m as V,o as J,q as O,F as x}from"./index-Cq-r5gHk.js";const C={class:"form"},L={key:0,class:"error-message"},E={key:1,class:"error-message"},q={key:2,class:"error-message"},F={__name:"LoginForm",emits:["login"],setup(w,{emit:S}){const f=S,t=c(""),d=c(""),m=c(""),o=c(""),N=c(""),k=c(!1),n=c(!1);function i(l){l==="login"&&(k.value=!1,setTimeout(()=>k.value=!0,0)),l==="password"&&(n.value=!1,setTimeout(()=>n.value=!0,0))}function a(){m.value="",o.value="",N.value="";let l=!1;if(t.value.trim()||(o.value="Введите логин",i("login"),l=!0),d.value.trim()||(N.value="Введите пароль",i("password"),l=!0),l)return;const r=(JSON.parse(localStorage.getItem("users"))||[]).find(I=>I.login===t.value);if(!r){m.value="Такой пользователь не зарегистрирован",i("login");return}if(r.password!==d.value){m.value="Неверный пароль",i("password");return}f("login",{login:t.value,password:d.value})}return(l,e)=>(u(),p("div",C,[e[5]||(e[5]=s("h2",null,"Вход",-1)),s("form",{onSubmit:P(a,["prevent"])},[e[2]||(e[2]=s("label",{for:"login"},"Логин",-1)),b(s("input",{id:"login","onUpdate:modelValue":e[0]||(e[0]=r=>t.value=r),class:U({"error-input":o.value,shake:k.value}),placeholder:"Введите логин"},null,2),[[y,t.value]]),o.value?(u(),p("p",L,v(o.value),1)):g("",!0),e[3]||(e[3]=s("label",{for:"password"},"Пароль",-1)),b(s("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=r=>d.value=r),type:"password",class:U({"error-input":N.value,shake:n.value}),placeholder:"Введите пароль"},null,2),[[y,d.value]]),N.value?(u(),p("p",E,v(N.value),1)):g("",!0),m.value?(u(),p("p",q,v(m.value),1)):g("",!0),e[4]||(e[4]=s("button",{type:"submit"},"Войти",-1))],32)]))}},A=_(F,[["__scopeId","data-v-65e0e9e0"]]),R={class:"form"},M={class:"form-group"},B={class:"input-wrapper"},T={key:0,class:"field-error"},j={class:"form-group"},z={class:"input-wrapper"},D={key:0,class:"field-error"},W={class:"form-group"},Z={class:"input-wrapper"},G={key:0,class:"field-error"},H={class:"form-group"},K={class:"input-wrapper"},Q={key:0,class:"field-error"},X={class:"form-group"},Y={class:"input-wrapper"},h={key:0,class:"field-error"},ee={class:"form-group"},se={class:"input-wrapper"},le={key:0,class:"field-error"},oe={class:"form-group"},te={class:"input-wrapper"},ae={key:0,class:"field-error"},re={class:"agreement"},ie=["disabled"],ne={key:0,class:"error"},ue={__name:"RegisterForm",emits:["register-success","register-error"],setup(w,{emit:S}){const f=S,t=c({login:"",lastName:"",firstName:"",middleName:"",email:"",password:"",confirmPassword:""}),d=c(!1),m=c(""),o=c({login:"",lastName:"",firstName:"",middleName:"",email:"",password:"",confirmPassword:""});function N(l){return/^[А-Яа-яЁё\s-]+$/.test(l)}function k(l){return/^[A-Za-z0-9_]+$/.test(l)}function n(l){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)}function i(){let l=!0;const e=t.value,r=JSON.parse(localStorage.getItem("users")||"[]");return o.value={login:"",lastName:"",firstName:"",middleName:"",email:"",password:"",confirmPassword:""},e.login?k(e.login)?r.find(I=>I.login===e.login)&&(o.value.login="Логин уже занят",l=!1):(o.value.login="Логин должен содержать только латинские буквы и цифры",l=!1):(o.value.login="Введите логин",l=!1),e.lastName?N(e.lastName)||(o.value.lastName="Фамилия должна быть на кириллице",l=!1):(o.value.lastName="Введите фамилию",l=!1),e.firstName?N(e.firstName)||(o.value.firstName="Имя должно быть на кириллице",l=!1):(o.value.firstName="Введите имя",l=!1),e.middleName?N(e.middleName)||(o.value.middleName="Отчество должно быть на кириллице",l=!1):(o.value.middleName="Введите отчество",l=!1),e.email?n(e.email)||(o.value.email="Неверный формат email",l=!1):(o.value.email="Введите email",l=!1),e.password||(o.value.password="Введите пароль",l=!1),e.confirmPassword?e.password!==e.confirmPassword&&(o.value.confirmPassword="Пароли не совпадают",l=!1):(o.value.confirmPassword="Подтвердите пароль",l=!1),l}function a(){if(m.value="",!d.value){m.value="Вы должны согласиться на обработку персональных данных",f("register-error",m.value);return}if(!i()){f("register-error","Ошибка валидации");return}const l={login:t.value.login,lastName:t.value.lastName,firstName:t.value.firstName,middleName:t.value.middleName,email:t.value.email,password:t.value.password,role:"user"},e=JSON.parse(localStorage.getItem("users")||"[]");e.push(l),localStorage.setItem("users",JSON.stringify(e)),localStorage.setItem("currentUser",JSON.stringify(l)),f("register-success",l)}return(l,e)=>(u(),p("div",R,[e[16]||(e[16]=s("h2",null,"Регистрация",-1)),s("div",M,[e[8]||(e[8]=s("label",{for:"login"},"Логин",-1)),s("div",B,[b(s("input",{id:"login","onUpdate:modelValue":e[0]||(e[0]=r=>t.value.login=r),placeholder:"Введите логин"},null,512),[[y,t.value.login]]),o.value.login?(u(),p("span",T,v(o.value.login),1)):g("",!0)])]),s("div",j,[e[9]||(e[9]=s("label",{for:"lastName"},"Фамилия",-1)),s("div",z,[b(s("input",{id:"lastName","onUpdate:modelValue":e[1]||(e[1]=r=>t.value.lastName=r),placeholder:"Иванова"},null,512),[[y,t.value.lastName]]),o.value.lastName?(u(),p("span",D,v(o.value.lastName),1)):g("",!0)])]),s("div",W,[e[10]||(e[10]=s("label",{for:"firstName"},"Имя",-1)),s("div",Z,[b(s("input",{id:"firstName","onUpdate:modelValue":e[2]||(e[2]=r=>t.value.firstName=r),placeholder:"Иван"},null,512),[[y,t.value.firstName]]),o.value.firstName?(u(),p("span",G,v(o.value.firstName),1)):g("",!0)])]),s("div",H,[e[11]||(e[11]=s("label",{for:"middleName"},"Отчество",-1)),s("div",K,[b(s("input",{id:"middleName","onUpdate:modelValue":e[3]||(e[3]=r=>t.value.middleName=r),placeholder:"Иванович"},null,512),[[y,t.value.middleName]]),o.value.middleName?(u(),p("span",Q,v(o.value.middleName),1)):g("",!0)])]),s("div",X,[e[12]||(e[12]=s("label",{for:"email"},"Email",-1)),s("div",Y,[b(s("input",{id:"email","onUpdate:modelValue":e[4]||(e[4]=r=>t.value.email=r),placeholder:"ivanov@email.ru"},null,512),[[y,t.value.email]]),o.value.email?(u(),p("span",h,v(o.value.email),1)):g("",!0)])]),s("div",ee,[e[13]||(e[13]=s("label",{for:"password"},"Пароль",-1)),s("div",se,[b(s("input",{id:"password","onUpdate:modelValue":e[5]||(e[5]=r=>t.value.password=r),type:"password",placeholder:"Введите пароль"},null,512),[[y,t.value.password]]),o.value.password?(u(),p("span",le,v(o.value.password),1)):g("",!0)])]),s("div",oe,[e[14]||(e[14]=s("label",{for:"confirmPassword"},"Повторите пароль",-1)),s("div",te,[b(s("input",{id:"confirmPassword","onUpdate:modelValue":e[6]||(e[6]=r=>t.value.confirmPassword=r),type:"password",placeholder:"Повторите пароль"},null,512),[[y,t.value.confirmPassword]]),o.value.confirmPassword?(u(),p("span",ae,v(o.value.confirmPassword),1)):g("",!0)])]),s("label",re,[b(s("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=r=>d.value=r)},null,512),[[V,d.value]]),e[15]||(e[15]=$(" Я согласен на обработку персональных данных "))]),s("button",{disabled:!d.value,onClick:a},"Зарегистрироваться",8,ie),m.value?(u(),p("p",ne,v(m.value),1)):g("",!0)]))}},de=_(ue,[["__scopeId","data-v-2f4ce60a"]]),me={class:"profile"},pe={class:"rol"},ve={key:0},fe={key:1,class:"admin-section"},ge={key:2,class:"user-section"},ce={__name:"UserProfile",props:{user:{type:Object,required:!0}},emits:["logout","submit-application","open-my-requests","open-admin-panel"],setup(w,{emit:S}){const f=S,t=w;function d(){f("logout")}function m(){f("submit-application")}function o(){f("open-my-requests")}function N(){f("open-admin-panel")}return(k,n)=>(u(),p("div",me,[s("h2",null,"Добро пожаловать, "+v(w.user.firstName)+"!",1),s("div",pe,[s("p",null,[n[0]||(n[0]=s("strong",null,"Роль:",-1)),$(" "+v(t.user.role==="admin"?"Администратор":"Пользователь"),1)])]),s("p",null,[n[1]||(n[1]=s("strong",null,"Логин:",-1)),$(" "+v(w.user.login),1)]),s("p",null,[n[2]||(n[2]=s("strong",null,"Пароль:",-1)),$(" "+v(w.user.password),1)]),s("p",null,[n[3]||(n[3]=s("strong",null,"Email:",-1)),$(" "+v(w.user.email),1)]),s("p",null,[n[4]||(n[4]=s("strong",null,"ФИО:",-1)),$(" "+v(w.user.lastName)+" "+v(w.user.firstName)+" "+v(w.user.middleName),1)]),t.user.role!=="admin"?(u(),p("p",ve," Теперь вы можете подать заявку на улучшение города, а так же просмотреть статус уже поданных вами заявок: ")):g("",!0),t.user.role==="admin"?(u(),p("div",fe,[n[5]||(n[5]=s("h3",null,"Админ-панель",-1)),n[6]||(n[6]=s("p",null,"Здесь доступен дополнительный контент для администратора. Администратор может рассмотерть заявки.",-1)),s("button",{onClick:N},"Панель управления")])):(u(),p("div",ge,[s("button",{onClick:m},"Подать заявку"),s("button",{onClick:o},"Мои заявки")])),s("button",{class:"logout-button",onClick:d},"Выйти")]))}},Ne=_(ce,[["__scopeId","data-v-16b4daef"]]),we={class:"account-container"},be={class:"win"},ye={class:"form-toggle-buttons"},ke={__name:"Account",emits:["login-success","logout","submit-application","open-admin-panel","open-my-requests"],setup(w,{emit:S}){const f=S,t=c(!1),d=c("login"),m=c(null);J(()=>{const i={login:"admin",password:"adminWSR",role:"admin"};let a=JSON.parse(localStorage.getItem("registeredUsers")||"[]");a.some(r=>r.login===i.login)||(a.push(i),localStorage.setItem("registeredUsers",JSON.stringify(a)));const e=localStorage.getItem("currentUser");e&&(m.value=JSON.parse(e),t.value=!0)});function o(i){d.value=i}function N(i){const a=JSON.parse(localStorage.getItem("registeredUsers")||"[]");a.some(e=>e.login===i.login)||(a.push(i),localStorage.setItem("registeredUsers",JSON.stringify(a)),localStorage.setItem("currentUser",JSON.stringify(i)),m.value=i,t.value=!0,f("login-success",i))}function k(i){const l=JSON.parse(localStorage.getItem("registeredUsers")||"[]").find(e=>e.login===i.login&&e.password===i.password);l&&(localStorage.setItem("currentUser",JSON.stringify(l)),m.value=l,t.value=!0,f("login-success",l))}function n(){t.value=!1,m.value=null,d.value="login",localStorage.removeItem("currentUser"),f("logout")}return(i,a)=>(u(),p("div",we,[t.value?(u(),O(Ne,{key:1,user:m.value,onLogout:n,onSubmitApplication:a[2]||(a[2]=l=>i.$emit("submit-application")),onOpenAdminPanel:a[3]||(a[3]=l=>i.$emit("open-admin-panel")),onOpenMyRequests:a[4]||(a[4]=l=>i.$emit("open-my-requests"))},null,8,["user"])):(u(),p(x,{key:0},[a[7]||(a[7]=s("div",{class:"soob"},[s("p",null,"Внимание! Чтобы подать заявку, необходимо зарегистрироваться/авторизоваться.")],-1)),s("div",be,[a[5]||(a[5]=s("h2",null,"Личный кабинет",-1)),a[6]||(a[6]=s("p",{class:"subtitle"},"Авторизуйтесь, чтобы получить доступ к личному кабинету!",-1)),s("div",ye,[s("button",{class:U({active:d.value==="login"}),onClick:a[0]||(a[0]=l=>o("login"))}," Вход ",2),s("button",{class:U({active:d.value==="register"}),onClick:a[1]||(a[1]=l=>o("register"))}," Регистрация ",2)])]),d.value==="login"?(u(),O(A,{key:0,onLogin:k})):g("",!0),d.value==="register"?(u(),O(de,{key:1,onRegisterSuccess:N})):g("",!0)],64))]))}},$e=_(ke,[["__scopeId","data-v-ee1db13a"]]);export{$e as default};
