import{_ as T,r as u,o as _,w as B,a as h,b as n,d as l,e as f,f as b,v as S,g as x,F as C,h as w,t as r,i as o,j as z,n as J}from"./index-CEPjqowA.js";const O={class:"container"},$={class:"form"},A=["value"],E={key:0},G={key:1,class:"success"},H={key:2,class:"errors"},K={class:"filter"},P={class:"request-list"},Q=["src"],W={class:"timestamp"},X={key:0,class:"modal-backdrop"},Y=["onClick"],Z={__name:"Submit",setup(q){const m=u(""),g=u(""),i=u(""),c=u(""),d=u(null),y=u("Все"),V=["Дороги","Освещение","Мусор","Вандализм","Другое"],p=u([]),a=u([]),k=u(""),v=u(""),I=u(!1),U=u(null);_(()=>{const s=localStorage.getItem("currentUserId");s?v.value=s:(v.value="user_"+Math.random().toString(36).substring(2,10),localStorage.setItem("currentUserId",v.value));const e=localStorage.getItem("requests");e&&(p.value=JSON.parse(e))}),B(p,s=>{localStorage.setItem("requests",JSON.stringify(s))},{deep:!0});function M(){return a.value=[],m.value||a.value.push("Название обязательно"),g.value||a.value.push("Описание обязательно"),i.value||a.value.push("Категория обязательна"),i.value==="Другое"&&!c.value.trim()&&a.value.push('Уточните категорию в поле "Другое"'),d.value?["image/jpeg","image/jpg","image/png","image/bmp"].includes(d.value.type)?d.value.size>10*1024*1024&&a.value.push("Максимальный размер фото — 10Мб"):a.value.push("Недопустимый формат изображения"):a.value.push("Фото обязательно"),a.value.length===0}function F(){if(!M())return;const s=new FileReader;s.onload=()=>{const e={id:Date.now(),title:m.value,description:g.value,category:i.value==="Другое"?`Другое: ${c.value}`:i.value,status:"Новая",timestamp:new Date().toLocaleString(),imageUrl:s.result,userId:v.value};p.value.push(e),m.value="",g.value="",i.value="",c.value="",d.value=null,k.value="Заявка успешно отправлена!",setTimeout(()=>k.value="",4e3)},s.readAsDataURL(d.value)}function N(s){d.value=s.target.files[0]}function j(s){if(s.status!=="Новая")return alert('Удалять можно только заявки со статусом "Новая"');if(s.userId!==v.value)return alert("Вы можете удалять только свои заявки");U.value=s,I.value=!0}function L(){p.value=p.value.filter(s=>s.id!==U.value.id),D()}function D(){I.value=!1,U.value=null}const R=h(()=>p.value.filter(s=>s.userId===v.value&&(y.value==="Все"||s.status===y.value)));return(s,e)=>(o(),n("div",O,[e[16]||(e[16]=l("h1",null,"Создание заявки",-1)),l("div",$,[e[7]||(e[7]=l("label",null,"Название",-1)),f(l("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),placeholder:"Например: Яма на дороге"},null,512),[[S,m.value]]),e[8]||(e[8]=l("label",null,"Описание",-1)),f(l("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),placeholder:"Опишите проблему..."},null,512),[[S,g.value]]),e[9]||(e[9]=l("label",null,"Категория",-1)),f(l("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>i.value=t)},[e[5]||(e[5]=l("option",{disabled:"",value:""},"Выберите категорию",-1)),(o(),n(C,null,w(V,t=>l("option",{key:t,value:t},r(t),9,A)),64))],512),[[x,i.value]]),i.value==="Другое"?(o(),n("div",E,[e[6]||(e[6]=l("label",null,"Уточните категорию",-1)),f(l("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>c.value=t),placeholder:"Например: Нарушение правил парковки"},null,512),[[S,c.value]])])):b("",!0),e[10]||(e[10]=l("label",null,"Фото (jpg, png, bmp, до 10Мб)",-1)),l("input",{type:"file",accept:"image/*",onChange:N},null,32),l("button",{class:"submit-btn",onClick:F},"Отправить заявку"),k.value?(o(),n("p",G,r(k.value),1)):b("",!0),a.value.length?(o(),n("ul",H,[(o(!0),n(C,null,w(a.value,t=>(o(),n("li",{key:t},r(t),1))),128))])):b("",!0)]),l("div",K,[e[12]||(e[12]=l("label",null,"Фильтр по статусу:",-1)),f(l("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>y.value=t)},e[11]||(e[11]=[l("option",null,"Все",-1),l("option",null,"Новая",-1),l("option",null,"Решено",-1),l("option",null,"Отклонена",-1)]),512),[[x,y.value]])]),l("div",P,[(o(!0),n(C,null,w(R.value,t=>(o(),n("div",{class:"request",key:t.id},[l("img",{src:t.imageUrl,alt:"Фото"},null,8,Q),l("h2",null,r(t.title),1),l("p",null,r(t.description),1),l("p",null,[e[13]||(e[13]=l("strong",null,"Категория:",-1)),z(" "+r(t.category),1)]),l("p",null,[e[14]||(e[14]=l("strong",null,"Статус:",-1)),l("span",{class:J("status "+t.status.toLowerCase())},r(t.status),3)]),l("p",W,"Добавлено: "+r(t.timestamp),1),I.value?(o(),n("div",X,[l("div",{class:"modal"},[e[15]||(e[15]=l("p",null,"Вы уверены, что хотите удалить заявку?",-1)),l("div",{class:"modal-buttons"},[l("button",{class:"yes-btn",onClick:L},"Да"),l("button",{class:"no-btn",onClick:D},"Нет")])])])):b("",!0),t.status==="Новая"&&t.userId===v.value?(o(),n("button",{key:1,class:"delete-btn",onClick:ee=>j(t)}," Удалить заявку ",8,Y)):b("",!0)]))),128))])]))}},te=T(Z,[["__scopeId","data-v-1997293e"]]);export{te as default};
